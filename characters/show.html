<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0b12" />
  <title>Karaktär – ConriNyx</title>
  <style>
    :root{--bg:#0b0b12;--panel:#151922;--muted:#9fb0c3;--txt:#e6eef7;--brand:#d4a72c;--chip:#242a36}
    html,body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:var(--brand);text-decoration:none}
    header{position:sticky;top:0;background:rgba(11,11,18,.8);backdrop-filter:blur(6px);border-bottom:1px solid #232838}
    .wrap{max-width:960px;margin:0 auto;padding:16px}
    .bar{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .back{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;background:var(--panel);border:1px solid #232838;border-radius:10px}
    .title{font-size:18px;font-weight:700}
    main .card{background:var(--panel);border:1px solid #232838;border-radius:16px;overflow:hidden}
    .top{display:grid;grid-template-columns:120px 1fr;gap:16px;padding:16px}
    .avatar{width:120px;height:120px;border-radius:14px;object-fit:cover;background:#0a0d12;border:1px solid #232838}
    .name{margin:0;font-size:22px}
    .sub{margin:4px 0 10px;color:var(--muted)}
    .tags{display:flex;flex-wrap:wrap;gap:8px}
    .tag{display:inline-block;background:var(--chip);border:1px solid #232838;border-radius:999px;padding:4px 10px;color:var(--muted);font-size:12px}
    section{margin-top:16px}
    h2{font-size:16px;margin:0 0 8px;color:var(--brand)}
    .bio p{margin:0 0 10px}
    .links{display:flex;flex-wrap:wrap;gap:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;background:#1b2130;border:1px solid #2a3144;border-radius:10px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}
    .grid img{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid #232838;background:#0a0d12}
    .empty{color:var(--muted)}
    footer{margin:28px 0 10px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:560px){.top{grid-template-columns:1fr}.avatar{width:100%;height:220px;border-radius:12px}}
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <a class="back" href="/characters/">← Till lista</a>
      <div class="title">Karaktär</div>
    </div>
  </header>

  <main class="wrap" id="app">
    <div class="card" id="card" hidden>
      <div class="top">
        <img id="avatar" class="avatar" alt="">
        <div>
          <h1 class="name" id="name">—</h1>
          <div class="sub" id="title">—</div>
          <div class="tags" id="tags"></div>
        </div>
      </div>

      <div class="body" style="padding:0 16px 16px">
        <section class="bio">
          <h2>Beskrivning</h2>
          <div id="bio"></div>
        </section>

        <section class="links">
          <h2 style="width:100%">Länkar</h2>
          <div id="links" class="links"></div>
        </section>

        <section>
          <h2>Galleri</h2>
          <div id="gallery" class="grid"></div>
        </section>
      </div>
    </div>

    <div id="msg" class="card" style="padding:20px">Laddar …</div>
  </main>

  <footer class="wrap">ConriNyx — FoundFamily</footer>

  <script>
  // Hämta från roten där din characters.json ligger
  const DATA_URL = "/characters.json";

  const el = id => document.getElementById(id);
  const params = new URLSearchParams(location.search);
  const id = params.get("id");

  const safe = s => String(s ?? "").replace(/[&<>"]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
  const isAbs = u => /^https?:\/\//i.test(u) || u.startsWith("/");

  async function run(){
    if(!id){ return showError("Ingen id angiven."); }

    let items;
    try{
      const res = await fetch(DATA_URL, {cache:"no-store"});
      if(!res.ok) throw new Error(res.status);
      items = await res.json();
    }catch(e){
      return showError("Kunde inte läsa data.");
    }

    const c = (items||[]).find(x => x.id === id);
    if(!c){ return showError("Hittade inte karaktären."); }

    document.title = `${c.name} — ConriNyx`;

    // Avatar
    const avatarSrc = c.avatar || (c.gallery && c.gallery[0]) || "";
    if(avatarSrc){ el("avatar").src = avatarSrc; el("avatar").alt = c.name || "avatar"; }

    // Namn, titel, taggar
    el("name").textContent  = c.name || "—";
    el("title").textContent = c.title || "";
    el("tags").innerHTML = (c.tags||[]).map(t=>`<span class="tag">#${safe(t)}</span>`).join("");

    // Bio
    el("bio").innerHTML = (c.bio||[]).map(p=>`<p>${safe(p)}</p>`).join("") || `<div class="empty">Ingen beskrivning.</div>`;

    // Länkar
    const links = (c.links||[]).map(l=>{
      const href = l?.href ? (isAbs(l.href) ? l.href : `/${l.href.replace(/^\/+/,'')}`) : "#";
      const label = l?.label || "Länk";
      return `<a class="btn" href="${safe(href)}">${safe(label)}</a>`;
    }).join("");
    el("links").innerHTML = links || `<div class="empty">Inga länkar.</div>`;

    // Galleri
    const gallery = (c.gallery && c.gallery.length ? c.gallery : (avatarSrc?[avatarSrc]:[]))
      .map(src=>`<img loading="lazy" src="${safe(src)}" alt="">`).join("");
    el("gallery").innerHTML = gallery || `<div class="empty">Inga bilder.</div>`;

    el("card").hidden = false;
    el("msg").remove();
  }

  function showError(txt){
    el("msg").innerHTML = `${safe(txt)} <a href="/characters/">Tillbaka</a>`;
  }

  run();
  </script>
</body>
</html>
