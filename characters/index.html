<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karaktärer – Conrinyx</title>
  <style>
    body{margin:0;background:#0e0f12;color:#e7e7ea;font-family:system-ui,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    h1{font-size:28px;margin:0 0 16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#15161b;border:1px solid #2a2c34;border-radius:14px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.25)}
    .thumb{aspect-ratio:16/9;background:#0c0d10;display:flex;align-items:center;justify-content:center}
    .thumb img{max-width:100%;max-height:100%;display:block}
    .pad{padding:12px}
    .title{font-weight:700;margin:0 0 6px}
    .sub{opacity:.8;margin:0 0 8px}
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
    .tag{font-size:12px;border:1px solid #3a3d47;border-radius:999px;padding:4px 8px;opacity:.9}
    .btn{display:inline-block;text-decoration:none}
    .btn > span{display:inline-block;background:linear-gradient(90deg,#e4b647,#c79b2a);
      color:#111;padding:8px 12px;border-radius:10px;font-weight:700}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Karaktärer</h1>
    <div id="list" class="grid" role="list"></div>
  </main>

  <script>
  // Absolut sökväg + cache-bust
  const DATA_URL = "/Conrinyx/data/characters.json?v=1";
  const toUrl = id => `/Conrinyx/characters/show.html?id=${encodeURIComponent(id)}`;

  fetch(DATA_URL)
    .then(r => {
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    })
    .then(items => {
      const list = document.getElementById('list');
      list.innerHTML = items.map(renderCard).join('');
    })
    .catch(err => {
      console.error("Kunde inte ladda karaktärer:", err);
      document.getElementById('list').innerHTML = "<p>Kunde inte ladda karaktärer.</p>";
    });

  function renderCard(x){
    const img = x.avatar ? `<img src="${x.avatar}" alt="">` : '';
    const tags = (x.tags||[]).slice(0,4).map(t=>`<span class="tag">#${t}</span>`).join('');
    return `
      <article class="card" role="listitem">
        <div class="thumb">${img}</div>
        <div class="pad">
          <p class="title">${escapeHTML(x.name)}</p>
          <p class="sub">${escapeHTML(x.title||'')}</p>
          <div class="tags">${tags}</div>
          <a class="btn" href="${toUrl(x.id)}"><span>Visa</span></a>
        </div>
      </article>
    `;
  }

  function escapeHTML(s){return String(s??'').replace(/[&<>"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));}
  </script>
</body>
</html>
