<!doctype html>
<html lang="sv">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Karaktärer – Conrinyx</title>
<link rel="stylesheet" href="/Conrinyx/index.css">
<body>
  <main class="wrap">
    <h1>Karaktärer</h1>
    <div id="list" class="grid" role="list"></div>
  </main>

  <script>
    // Viktigt: rätt path till JSON
    const DATA_URL = "/Conrinyx/data/characters.json";

    // Bygger rätt länk till show-sidan under /Conrinyx/
    const toUrl = id => `/Conrinyx/characters/show.html?id=${encodeURIComponent(id)}`;

    fetch(DATA_URL)
      .then(r => r.json())
      .then(items => {
        const list = document.getElementById('list');
        list.innerHTML = items.map(x => renderCard(x)).join('');
      })
      .catch(err => {
        console.error(err);
        document.getElementById('list').innerHTML = "<p>Kunde inte ladda karaktärer.</p>";
      });

    function renderCard(x){
      const img = x.avatar ? `<img src="${x.avatar}" alt="">` : '';
      const tags = (x.tags||[]).slice(0,4).map(t=>`<span class="tag">#${t}</span>`).join('');
      return `
        <article class="card" role="listitem">
          <div class="thumb">${img}</div>
          <div class="pad">
            <p class="title">${escapeHTML(x.name)}</p>
            <p class="sub">${escapeHTML(x.title||'')}</p>
            <div class="tags">${tags}</div>
            <a class="btn" href="${toUrl(x.id)}">Visa</a>
          </div>
        </article>
      `;
    }

    function escapeHTML(s){return String(s??'').replace(/[<&>"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}
  </script>
</body>
</html>
